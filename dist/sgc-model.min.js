define("Collection/mixins/collectionHelpers",[],function(){return function(t){return{isEmpty:function(){return 0===this.length},previousModel:function(t){if(t){var e=this.indexOf(t);if(void 0!==e)return this.at(e-1)}},remove:function(t){if(t&&_.isFunction(t)){var e=[];return this.each(function(i){t(i)&&e.push(i)}),void this.remove(e)}return Backbone.Collection.prototype.remove.apply(this,arguments)},nextModel:function(t){if(t){var e=this.indexOf(t);if(void 0!==e)return this.at(e+1)}},removeAll:function(){for(var t=[],e=this.models.length-1;e>=0;e--)t.push(this.models[e]);return this.remove(t),this.resetPaginate(),this.trigger("remove:all"),t},clear:function(t){var e=this.models;this.reset([]);for(var i=e.length-1;i>=0;i--)e[i].clear(t);this.stopListening(),this.parent&&(this.parent=null)},where:function(t){var e={};for(var i in t)"function"==typeof t[i]&&(e[i]=t[i],delete t[i]);var n;return n=t.keys().length?Backbone.Collection.prototype.where.apply(this,arguments):this,n&&n.filter?n.filter(function(t){for(var i in e)if(!e[i](t[i]))return!1;return!0}):n},root:function(){for(var t=this,e="";t.parent.instance;){var i=t.parent;t=i.instance,e+=i.path}return{instance:t,path:e}},clone:function(t){t||(t={});var e=t.models?this.models:null;return new this.constructor(e,{url:this.url})},sgClientFilter:function(e){var i=this.where(e),n=t.extend({model:this.model,url:this.url,schema:this.schema});return new n(i)},mergeWithCollection:function(t){for(var e=0;e<t.models.length;e++)this.add(t.models[e])},saveAndMergeByPosition:function(){var t=this.clone(),e=this,i=t.save();return i.done(function(){for(var i=0;i<t.models.length;i++)e.models[i].set(t.models[i])}),i},clientSort:function(){return Backbone.Collection.prototype.sort.apply(this,arguments)},set:function(t,e){if(_.isArray(t)&&t.length&&!_.isObject(t[0])){var i=[];return t.forEach(function(t){i.push({_id:t})}),t=i,this.set(t,e)}return Backbone.Collection.prototype.set.apply(this,arguments)},add:function(t,e){return _.isString(t)&&this.add({_id:t},e),Backbone.Collection.prototype.add.apply(this,[t,e])}}}}),define("Collection/mixins/collectionPagination",[],function(){return function(){return{_paginate:{currentPage:0,perPage:0,maxPages:0,_maxPagesReached:!1,dummyModels:!1},isMaxReached:function(){return this._paginate._maxPagesReached},removePaginate:function(){this._paginate={currentPage:0,perPage:0,maxPages:0,_maxPagesReached:!1}},resetPaginate:function(){this._paginate.currentPage=0,this._paginate._maxPagesReached=!1,this._pagesAlreadyFetched=null},sgPaginate:function(t){return _.extend(this._paginate,t),this},_preparePaginateFetchOptions:function(t){t=_.defaults(t||{},{data:{},first:null,remove:!1,success:null}),this._paginate.perPage&&(t.data.offset=this._paginate.currentPage*this._paginate.perPage,t.data.limit=this._paginate.perPage);var e=t.success,i=this;return t.success=function(n,r){var s=r;return t.parse&&(s=i.parse(r,t)),i._paginate.currentPage++,i._paginate._maxPagesReached=i._paginate.currentPage===i._paginate.maxPages||s.length<i._paginate.perPage,e&&e.apply(this,arguments)},t},nextPage:function(t){return t=_.defaults(t||{},{paginate:!0}),this.isMaxReached()?!1:(t.first&&(this._paginate.currentPage=0),this.fetch(t))},getPage:function(t){return t||(t={data:{}}),t.remove=!1,t.data||(t.data={}),this._paginate.perPage&&null!=t.page&&(t.data.offset=t.page*this._paginate.perPage,t.data.limit=(t.numberPages||1)*this._paginate.perPage),this.dummyFetch(t)},fillPage:function(t){if(null!=t.page){this._pagesAlreadyFetched=this._pagesAlreadyFetched||[];var e=t.numberPages||1;if(t.refill||!this._pagesAlreadyFetched.contains(t.page)){this._pagesAlreadyFetched.push(t.page);for(var i=t.page*this._paginate.perPage,n=i+e*this._paginate.perPage,r=this,s=function(){return n-r.length};s()>0;)this.add({});return this.getPage(t).done(function(t){t.forEach(function(t,e){console.log(i),r.models[i+e].set(t)})})}}},resetSGSort:function(){this.sgSort({})},sgSort:function(t){return this._sort=t,this},getSGSort:function(){return this._sort||(this._sort={}),this._sort},addSGSort:function(t,e,i){i=_.defaults(i||{},{silent:!1}),this.getSGSort()[t]=e,i.silent||(this.trigger("change"),this.trigger("add:sort",t,e))},removeSGSort:function(t,e){e=_.defaults(e||{},{silent:!1}),delete this.getSGSort()[t],e.silent||(this.trigger("change"),this.trigger("add:sort",t))},resetSGFilter:function(){this.sgFilter({})},sgFilter:function(t){return this._filters=t,this},getSGFilter:function(){return this._filters||(this._filters={}),this._filters},addSGFilter:function(t,e,i){i=_.defaults(i||{},{silent:!1}),this.getSGFilter()[t]=e,i.silent||(this.trigger("change"),this.trigger("add:filter",t,e))},removeSGFilter:function(t,e){e=_.defaults(e||{},{silent:!1}),delete this.getSGFilter()[t],e.silent||(this.trigger("change"),this.trigger("remove:filter",t))},isLoading:function(){return this._isLoading}}}}),define("Collection/mixins/collectionSync",[],function(){return function(){return{_prepareFetchOptions:function(t){t=_.defaults(t||{},{data:{}}),this._sort&&("string"==typeof this._sort?t.data.sortBy=this._sort:(t.data.sortBy=this._sort.keys()[0],t.data.sortHow=this._sort[t.data.sortBy]));for(var e in this._filters)t.data[e]=this._filters[e];return t},fetch:function(t){t=_.defaults(t||{},{paginate:!1}),t.paginate&&(t=this._preparePaginateFetchOptions(t)),t=this._prepareFetchOptions(t),this._isLoading=!0,this.trigger("loading-start");var e=t.success,i=this;return t.success=function(){i._isLoading=!1,i.trigger("Fetch:success"),i.trigger("loading-stop"),e&&e.apply(this,arguments)},t.error=function(t){t&&t.apply&&t.apply(this,arguments),i.trigger("Fetch:error",t),i._isLoading=!1,i.trigger("loading-stop")},Backbone.Collection.prototype.fetch.apply(this,[t])}}}}),define("Collection/Collection",["./mixins/collectionHelpers","./mixins/collectionPagination","./mixins/collectionSync"],function(t,e,i){var n=require("backbone"),r=n.Collection.extend({_isLoading:!1,_sort:{},_filters:{},parent:{instance:null,path:null},constructor:function(t,e){this.removePaginate(),this.resetSGSort(),this.resetSGFilter(),e&&(e.url&&(this.url=e.url),e.parent&&(this.parent=e.parent));var i=n.Collection.prototype.constructor.apply(this,arguments);return this.updateUrl(),i},updateUrl:function(){if(this.parent.instance&&!this.parent.instance.id){var t="change:"+this.parent.instance.idAttribute;this.listenTo(this.parent.instance,t,function(t){var e=t.url;"function"==typeof e&&(e=e()),this.url=e+"/"+this.parent.path},this)}}});return _.extend(r.prototype,t(r)),_.extend(r.prototype,e(r)),_.extend(r.prototype,i(r)),r}),define("Model/mixins/modelSchemaPropertiesDefinition",[],function(){return function(){return{_generateGetSetForAttributes:function(t){for(var e=t.length-1;e>=0;e--)this._generateGetSetForAttribute(t[e])},_generatedGetterAndSetter:function(){return this.__generatedGetterAndSetter||(this.__generatedGetterAndSetter={}),this.__generatedGetterAndSetter},_generateGetSetForAttribute:function(t){if(!this._generatedGetterAndSetter()[t]){var e={};e.get=this._defineGetter(t);var i=this._defineSetter(t);i&&(e.set=i);try{Object.defineProperty(this,t,e),this._generatedGetterAndSetter()[t]=!0}catch(n){throw"error with property "+t}}},_defineGetter:function(t){var e="get"+t.capitalize();return _.isFunction(this[e])&&this[e]?this[e]:function(){return this.get(t)}},_defineSetter:function(t){var e="set"+t.capitalize();return _.isFunction(this[e])&&this[e]?this[e]:function(e){return this.set(t,e)}}}}}),define("Model/mixins/modelGetter",[],function(){return function(){return{__existGetterForAttribute:function(t){if(!_.isString(t))return!1;var e=t.asGetter();return e in this&&_.isFunction(this[e])},get:function(t,e){return e=_.defaults(e||{},{getterForce:!1}),!e.getterForce&&this.__existGetterForAttribute(t)?this[t.asGetter()](t,_.clone(e||{})):Backbone.Model.prototype.get.apply(this,arguments)}}}}),define("Model/mixins/modelSetter",[],function(){return function(){return{__existSetterForAttribute:function(t){if(!_.isString(t))return!1;var e=t.asSetter();return e in this&&_.isFunction(this[e])},set:function(t,e,i){return _.isObject(t)&&_.isObject(e)&&!i&&(i=e),i=_.defaults(i||{},{setterForce:!1,setEach:!1}),!i.setterForce&&this.__existSetterForAttribute(t)?this[t.asSetter()](e,_.clone(i||{})):i.setEach&&_.isObject(t)?void _.each(t,function(e,n){this.set(n,e,_.clone(i),t)},this):Backbone.Model.prototype.set.apply(this,[t,e,i])}}}}),define("Model/Model",["./mixins/modelSchemaPropertiesDefinition","./mixins/modelGetter","./mixins/modelSetter"],function(t,e,i){var n=require("backbone"),r=n.Model.extend({constructor:function(t,e){e=_.defaults(e||{},{automaticGetterAndSetter:!1}),n.Model.prototype.constructor.apply(this,arguments),e.automaticGetterAndSetter&&t&&this._generateGetSetForAttributes(_.keys(t))},clear:function(){return this.stopListening(),this.collection&&(this.collection=null),this._SGISCLEARED=!0,n.Model.prototype.clear.apply(this,arguments)}});return _.extend(r.prototype,t(r)),_.extend(r.prototype,e(r)),_.extend(r.prototype,i(r)),r}),define("sgc-model",["require","./Collection/Collection","./Model/Model"],function(t){var e=t("./Collection/Collection"),i=t("./Model/Model");return{Collection:e,Model:i}});